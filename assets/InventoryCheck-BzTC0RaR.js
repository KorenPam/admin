import{d as W,u as X,a as d,x as Y,q as Z,c as x,b as g,e as t,H as L,w as o,k as ee,I as te,G as D,K as ae,J as le,N as Q,n as c,C as oe,o as v,l as p,D as ne,F as se,L as ue,g as de,i as re,j as ie,M as ce,O as M,R as pe,Q as me,W as ve,P as fe,_ as _e}from"./index-CWo0abK5.js";/* empty css                  *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                *//* empty css               */import"./el-form-item-l0sNRNKZ.js";import{i as V}from"./http-CaWKIfWx.js";import{l as ye}from"./product-B2KrNTYH.js";function be(r){return V.post("/inventoryCheck/page",r)}function ge(r){return V.post("/inventoryCheck/create",r)}function Ie(r){return V.post("/inventoryCheck/update",r)}function ke(r,N){return V.post(`/inventoryCheck/confirm/${r}/${N}`)}const Ve={class:"inventory-checks-container"},he={class:"header"},we={style:{display:"flex","align-items":"center",gap:"10px"}},Ce={class:"dialog-footer"},Ee=W({__name:"InventoryCheck",setup(r){const f=X().userInfo,U=d([]),h=d([]),w=d(!1),C=d(1),S=d(10),P=d(0),m=d(!1),i=d(!1),n=d({checkId:null,userId:f.userId,username:f.username,status:"未确认",description:"",items:[]}),_=d([]),E=async()=>{w.value=!0;try{const l=await be({page:C.value,size:S.value});l.data.code==="200"?(U.value=l.data.data.records,P.value=l.data.data.total):c.error("获取盘点单失败")}catch{c.error("请求失败")}finally{w.value=!1}},$=async()=>{const l=await ye();l.data.code==="200"?h.value=l.data.data:c.error("获取产品失败")},O=l=>{C.value=l,E()},j=()=>{m.value=!0,i.value=!1,_.value=[],n.value={checkId:null,userId:f.userId,username:f.username,status:"未确认",description:"",items:[]}},q=l=>{m.value=!0,i.value=!0,_.value=l.items.map(e=>e.productId),n.value={...l},n.value.userId=f.userId},A=async()=>{if(n.value.items.length===0){c.error("请添加盘点商品");return}const l={...n.value};i.value&&(l.checkId=n.value.checkId);try{const e=i.value?await Ie(l):await ge(l);e.data.code==="200"?((l.status==="已确认"||l.status==="已取消")&&ke(l.checkId,l.userId).then(s=>{s.data.code}),c.success(e.data.data),m.value=!1,E()):c.error(e.data.data)}catch{c.error("提交失败")}finally{i.value=!1}};return Y(_,l=>{n.value.items=l.map(e=>{const s=h.value.find(y=>y.productId===e),u=n.value.items.find(y=>y.productId===e);return{productId:e,productName:(s==null?void 0:s.productName)||"",systemQuantity:(u==null?void 0:u.systemQuantity)||(s==null?void 0:s.stockQuantity)||0,actualQuantity:(u==null?void 0:u.actualQuantity)||(s==null?void 0:s.stockQuantity)||0,unitPrice:(s==null?void 0:s.price)||1}})}),Z(()=>{$(),E()}),(l,e)=>{const s=ee,u=ne,y=se,G=oe,H=ae,T=ie,b=re,I=me,z=ce,B=ve,F=fe,J=de,K=le,R=te;return v(),x(Q,null,[g("div",Ve,[g("div",he,[e[7]||(e[7]=g("h2",null,"盘点单管理",-1)),t(s,{type:"primary",onClick:j},{default:o(()=>e[6]||(e[6]=[p("创建盘点单")])),_:1})]),L((v(),D(G,{data:U.value,style:{width:"100%",height:"90%"},"row-style":{height:"70px"}},{default:o(()=>[t(u,{prop:"checkId",label:"盘点单ID"}),t(u,{prop:"username",label:"操作人"}),t(u,{prop:"checkDate",label:"盘点日期"}),t(u,{prop:"status",label:"状态"},{default:o(a=>[t(y,{type:a.row.status==="已确认"?"success":"warning"},{default:o(()=>[p(ue(a.row.status),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"description",label:"描述"}),t(u,{label:"操作",width:"200",align:"center"},{default:o(a=>[t(s,{size:"small",type:"info",onClick:k=>q(a.row)},{default:o(()=>e[8]||(e[8]=[p("编辑")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,w.value]]),t(H,{"current-page":C.value,"page-size":S.value,total:P.value,layout:"prev, pager, next",background:"",style:{"margin-top":"6px"},onCurrentChange:O},null,8,["current-page","page-size","total"])]),t(K,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),title:i.value?"编辑盘点单":"新增盘点单",width:"600px"},{footer:o(()=>[g("div",Ce,[t(s,{onClick:e[4]||(e[4]=a=>m.value=!1)},{default:o(()=>e[11]||(e[11]=[p("取消")])),_:1}),t(s,{type:"primary",onClick:A},{default:o(()=>e[12]||(e[12]=[p("提交")])),_:1})])]),default:o(()=>[t(J,{model:n.value,"label-width":"100px",disabled:n.value.status==="已取消"},{default:o(()=>[t(b,{label:"当前操作人"},{default:o(()=>[t(T,{modelValue:n.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.username=a),disabled:""},null,8,["modelValue"])]),_:1}),t(b,{label:"商品选择"},{default:o(()=>[t(z,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=a),multiple:"",placeholder:"选择商品",style:{width:"100%"}},{default:o(()=>[(v(!0),x(Q,null,M(h.value,a=>(v(),D(I,{key:a.productId,label:a.productName,value:a.productId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(v(!0),x(Q,null,M(n.value.items,a=>(v(),D(b,{key:a.productId,label:a.productName},{default:o(()=>[g("div",we,[t(B,null,{default:o(()=>e[9]||(e[9]=[p("系统库存")])),_:1}),t(F,{modelValue:a.systemQuantity,"onUpdate:modelValue":k=>a.systemQuantity=k,disabled:"",style:{width:"140px"}},null,8,["modelValue","onUpdate:modelValue"]),t(B,null,{default:o(()=>e[10]||(e[10]=[p("实际库存")])),_:1}),t(F,{modelValue:a.actualQuantity,"onUpdate:modelValue":k=>a.actualQuantity=k,min:0,style:{width:"140px"},disabled:n.value.status==="已确认"||n.value.status==="已取消"},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),_:2},1032,["label"]))),128)),t(b,{label:"描述"},{default:o(()=>[t(T,{modelValue:n.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.description=a),type:"textarea",placeholder:"描述信息"},null,8,["modelValue"])]),_:1}),L(t(b,{label:"状态"},{default:o(()=>[t(z,{modelValue:n.value.status,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.status=a),placeholder:"请选择状态",style:{width:"100%"}},{default:o(()=>[t(I,{label:"待审核",value:"待审核"}),t(I,{label:"已确认",value:"已确认"}),t(I,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),_:1},512),[[pe,i.value]])]),_:1},8,["model","disabled"])]),_:1},8,["modelValue","title"])],64)}}}),Fe=_e(Ee,[["__scopeId","data-v-5f92a8dd"]]);export{Fe as default};
