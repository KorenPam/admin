import{d as oe,u as de,a as r,x as G,q as ne,c as U,b as S,e,H,w as l,k as re,I as ie,G as k,K as pe,J as me,N as P,n as m,C as ve,o as c,l as o,D as ce,L as p,F as fe,T as _e,U as be,V as ge,g as ye,i as Ve,j as Ie,M as we,Q as Se,O as J,R as ke,W as Ae,P as De,_ as xe}from"./index-CWo0abK5.js";/* empty css                  *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                *//* empty css               */import"./el-form-item-l0sNRNKZ.js";/* empty css                             */import{p as Ee,u as Ce,c as Ne,a as Ue}from"./sale-DEijK_b1.js";import{l as Pe}from"./product-B2KrNTYH.js";import"./http-CaWKIfWx.js";const Te={class:"sale-orders-container"},Oe={class:"header"},he={style:{display:"flex","align-items":"center",gap:"10px"}},qe={style:{"font-weight":"bold"}},ze=oe({__name:"SaleOrders",setup(Be){const z=de(),A=z.userInfo;z.stockOutTableData;const B=r([]),T=r(!1),O=r(1),F=r(10),L=r(0),D=r([]),x=r(!1),i=r({saleId:0,userId:0,userName:"",orderDate:"",totalAmount:0,status:"",paymentStatus:"",shippingAddress:"",billingAddress:"",items:[]}),b=r(!1),g=r(!1),s=r({saleId:0,userId:A.userId,userName:A.username,orderDate:"",totalAmount:0,status:"",paymentStatus:"",shippingAddress:"",billingAddress:"",items:[]}),V=r([]),E=r(0),K=u=>{const a=D.value.find(d=>d.productId===u);return(a==null?void 0:a.stockQuantity)??1},C=async()=>{T.value=!0;try{const u=await Ee({page:O.value,size:F.value});u.data.code==="200"?(B.value=u.data.data.records,L.value=u.data.data.total):m.error("获取销售订单失败")}catch{m.error("请求失败")}finally{T.value=!1}},R=async()=>{const u=await Pe();u.data.code==="200"?D.value=u.data.data:m.error("获取商品失败")},W=u=>{O.value=u,C()},X=u=>{i.value={...u},x.value=!0},Y=()=>{g.value=!1,s.value={saleId:0,userId:A.userId,userName:A.username,orderDate:"",totalAmount:0,status:"待发货",paymentStatus:"未付款",shippingAddress:"",billingAddress:"",items:[]},V.value=[],E.value=0,b.value=!0},Z=u=>{g.value=!0,s.value={...u},V.value=s.value.items.map(a=>a.productId),Q(),b.value=!0},ee=async()=>{s.value.totalAmount=E.value;try{if(g.value){const u=await Ce(s.value);u.data.code==="200"?(m.success("更新成功"),b.value=!1,(s.value.status==="已完成"||s.value.status==="已取消")&&Ne(s.value.saleId,s.value.userId).then(a=>{a.data.code==="200"?m.success(a.data.data):m.error(a.data.data)}),C()):m.error("更新失败："+u.data.data)}else{const u=await Ue(s.value);u.data.code==="200"?(m.success("新增成功"),b.value=!1,C()):m.error("新增失败："+u.data.data)}}catch{m.error("保存失败")}},Q=()=>{E.value=s.value.items.reduce((u,a)=>u+a.quantity*a.unitPrice,0)},ae=u=>{u==="已取消"?s.value.paymentStatus="退款":u==="已完成"&&(s.value.paymentStatus="已付款")};return G(V,u=>{s.value.items=u.map(a=>{const d=D.value.find(I=>I.productId===a),n=(d==null?void 0:d.price)||1,y=s.value.items.find(I=>I.productId===a),N=y?y.quantity:1;return{productId:a,productName:(d==null?void 0:d.productName)||"",quantity:N,unitPrice:n}})}),G(()=>s.value.items,()=>{Q()},{deep:!0}),ne(()=>{C(),R()}),(u,a)=>{const d=re,n=ce,y=fe,N=ve,I=pe,f=be,le=_e,te=ge,$=me,h=Ie,_=Ve,v=Se,q=we,M=Ae,j=De,se=ye,ue=ie;return c(),U(P,null,[S("div",Te,[S("div",Oe,[a[11]||(a[11]=S("h2",null,"销售订单管理",-1)),e(d,{type:"primary",onClick:Y},{default:l(()=>a[10]||(a[10]=[o("新增销售订单")])),_:1})]),H((c(),k(N,{data:B.value,style:{width:"100%",height:"90%"},"row-style":{height:"70px"}},{default:l(()=>[e(n,{prop:"saleId",label:"销售订单ID"}),e(n,{prop:"userName",label:"操作人"}),e(n,{prop:"orderDate",label:"订单日期"}),e(n,{prop:"totalAmount",label:"总金额"},{default:l(t=>[o(" ¥"+p(t.row.totalAmount),1)]),_:1}),e(n,{prop:"status",label:"订单状态"},{default:l(t=>[e(y,{type:t.row.status==="已完成"?"success":"warning"},{default:l(()=>[o(p(t.row.status),1)]),_:2},1032,["type"])]),_:1}),e(n,{prop:"paymentStatus",label:"支付状态"},{default:l(t=>[e(y,{type:t.row.paymentStatus==="已付款"?"success":"danger"},{default:l(()=>[o(p(t.row.paymentStatus),1)]),_:2},1032,["type"])]),_:1}),e(n,{label:"操作",width:"300",align:"center"},{default:l(t=>[e(d,{size:"small",onClick:w=>X(t.row)},{default:l(()=>a[12]||(a[12]=[o("查看详情")])),_:2},1032,["onClick"]),e(d,{size:"small",type:"info",onClick:w=>Z(t.row)},{default:l(()=>a[13]||(a[13]=[o("编辑")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,T.value]]),e(I,{"current-page":O.value,"page-size":F.value,total:L.value,background:"",style:{"margin-top":"5px"},layout:"prev, pager, next",onCurrentChange:W},null,8,["current-page","page-size","total"])]),e($,{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=t=>x.value=t),title:"销售订单详情",width:"700px"},{footer:l(()=>[e(d,{onClick:a[0]||(a[0]=t=>x.value=!1)},{default:l(()=>a[15]||(a[15]=[o("关闭")])),_:1})]),default:l(()=>[e(le,{column:2,border:""},{default:l(()=>[e(f,{label:"订单ID"},{default:l(()=>[o(p(i.value.saleId),1)]),_:1}),e(f,{label:"操作人"},{default:l(()=>[o(p(i.value.userName),1)]),_:1}),e(f,{label:"下单日期"},{default:l(()=>[o(p(i.value.orderDate),1)]),_:1}),e(f,{label:"状态"},{default:l(()=>[e(y,{type:i.value.status==="已完成"?"success":"warning"},{default:l(()=>[o(p(i.value.status),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"支付状态"},{default:l(()=>[e(y,{type:i.value.paymentStatus==="已付款"?"success":"danger"},{default:l(()=>[o(p(i.value.paymentStatus),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"总金额"},{default:l(()=>[o(" ¥"+p(i.value.totalAmount),1)]),_:1}),e(f,{label:"收货地址"},{default:l(()=>[o(p(i.value.shippingAddress),1)]),_:1}),e(f,{label:"账单地址"},{default:l(()=>[o(p(i.value.billingAddress),1)]),_:1})]),_:1}),e(te,null,{default:l(()=>a[14]||(a[14]=[o("商品列表")])),_:1}),e(N,{data:i.value.items,size:"small",border:""},{default:l(()=>[e(n,{prop:"productName",label:"商品名"}),e(n,{prop:"quantity",label:"数量"}),e(n,{prop:"unitPrice",label:"单价"}),e(n,{prop:"totalAmount",label:"总金额"})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e($,{modelValue:b.value,"onUpdate:modelValue":a[9]||(a[9]=t=>b.value=t),title:g.value?"编辑销售订单":"新增销售订单",width:"600px"},{footer:l(()=>[e(d,{onClick:a[8]||(a[8]=t=>b.value=!1)},{default:l(()=>a[18]||(a[18]=[o("取消")])),_:1}),e(d,{type:"primary",onClick:ee},{default:l(()=>a[19]||(a[19]=[o("保存")])),_:1})]),default:l(()=>[e(se,{model:s.value,"label-width":"100px",disabled:s.value.status==="已取消"||s.value.status==="已完成"},{default:l(()=>[e(_,{label:"当前操作人"},{default:l(()=>[e(h,{modelValue:s.value.userName,"onUpdate:modelValue":a[2]||(a[2]=t=>s.value.userName=t),disabled:""},null,8,["modelValue"])]),_:1}),e(_,{label:"订单状态"},{default:l(()=>[e(q,{modelValue:s.value.status,"onUpdate:modelValue":a[3]||(a[3]=t=>s.value.status=t),placeholder:"请选择",disabled:!g.value,onChange:ae},{default:l(()=>[e(v,{label:"待发货",value:"待发货"}),e(v,{label:"已完成",value:"已完成"}),e(v,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(_,{label:"支付状态"},{default:l(()=>[e(q,{modelValue:s.value.paymentStatus,"onUpdate:modelValue":a[4]||(a[4]=t=>s.value.paymentStatus=t),placeholder:"请选择",disabled:!g.value||s.value.status==="已取消"},{default:l(()=>[s.value.status==="已取消"?(c(),k(v,{key:0,label:"退款",value:"退款"})):s.value.status==="已完成"?(c(),k(v,{key:1,label:"已付款",value:"已付款"})):(c(),U(P,{key:2},[e(v,{label:"未付款",value:"未付款"}),e(v,{label:"已付款",value:"已付款"}),e(v,{label:"退款",value:"退款"})],64))]),_:1},8,["modelValue","disabled"])]),_:1}),e(_,{label:"收货地址"},{default:l(()=>[e(h,{modelValue:s.value.shippingAddress,"onUpdate:modelValue":a[5]||(a[5]=t=>s.value.shippingAddress=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"账单地址"},{default:l(()=>[e(h,{modelValue:s.value.billingAddress,"onUpdate:modelValue":a[6]||(a[6]=t=>s.value.billingAddress=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"产品选择"},{default:l(()=>[e(q,{modelValue:V.value,"onUpdate:modelValue":a[7]||(a[7]=t=>V.value=t),multiple:"",placeholder:"选择产品",style:{width:"100%"}},{default:l(()=>[(c(!0),U(P,null,J(D.value,t=>H((c(),k(v,{key:t.productId,label:t.productName+"（库存："+t.stockQuantity+"）",value:t.productId,disabled:t.stockQuantity===0},null,8,["label","value","disabled"])),[[ke,t.status==="可用"]])),128))]),_:1},8,["modelValue"])]),_:1}),(c(!0),U(P,null,J(s.value.items,t=>(c(),k(_,{key:t.productId,label:t.productName},{default:l(()=>[S("div",he,[e(M,null,{default:l(()=>a[16]||(a[16]=[o("数量")])),_:1}),e(j,{modelValue:t.quantity,"onUpdate:modelValue":w=>t.quantity=w,min:1,max:K(t.productId),placeholder:"数量",style:{width:"130px"}},null,8,["modelValue","onUpdate:modelValue","max"]),e(M,null,{default:l(()=>a[17]||(a[17]=[o("单价")])),_:1}),e(j,{modelValue:t.unitPrice,"onUpdate:modelValue":w=>t.unitPrice=w,min:.01,step:.01,placeholder:"采购单价",disabled:!g.value},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),_:2},1032,["label"]))),128)),e(_,{label:"总金额"},{default:l(()=>[S("div",qe,"¥"+p(E.value),1)]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue","title"])],64)}}}),Xe=xe(ze,[["__scopeId","data-v-340700eb"]]);export{Xe as default};
