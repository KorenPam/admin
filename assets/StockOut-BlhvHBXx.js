import{d as Z,a as s,x as O,q as ee,c as V,b as E,H as ae,e as l,I as te,G as k,w as u,K as le,J as oe,n as w,C as ue,o as r,D as ne,F as se,l as i,L as Q,k as de,g as re,i as ie,M as pe,N as q,O as L,j as ce,Q as me,W as ve,P as fe,_ as _e}from"./index-CWo0abK5.js";/* empty css                  *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css               */import{i as h}from"./http-CaWKIfWx.js";import{l as be}from"./product-B2KrNTYH.js";import{b as ge}from"./sale-DEijK_b1.js";function Ie(p){return h.post("/outbound/page",p)}function ye(p){return h.post("/outbound/update",p)}function Ve(p,b){return h.post(`/outbound/confirm/${p}/${b}`)}const Ee={class:"stockout-container"},ke={style:{display:"flex","align-items":"center",gap:"10px"}},we={class:"dialog-footer"},xe=Z({__name:"StockOut",setup(p){const b=s([]),g=s([]),x=s([]),N=s(!1),f=s(!1),z=s(!1),D=s(null),C=s(1),B=s(10),T=s(0),o=s({saleId:0,outboundDate:"",userId:0,userName:"",status:"待出库",description:"",items:[]}),c=s([]),F=s(0),j=t=>{const e=g.value.find(n=>n.productId===t);return(e==null?void 0:e.price)??"-"},P=async()=>{N.value=!0;try{const t=await Ie({page:C.value,size:B.value});t.data.code==="200"?(b.value=t.data.data.records,T.value=t.data.data.total):w.error("获取出库单失败")}finally{N.value=!1}},G=async()=>{const t=await ge();t.data.code==="200"&&(x.value=t.data.data)},H=async()=>{const t=await be();t.data.code==="200"?g.value=t.data.data:w.error("获取产品列表失败")},J=t=>{C.value=t,P()},K=t=>{f.value=!0,z.value=!0,D.value=t.outboundId,c.value=t.items.map(e=>e.productId),Object.assign(o.value,{...t,items:[...t.items]})},W=async()=>{const t={...o.value,totalQuantity:F.value};if(z.value&&D.value!==null){t.outboundId=D.value;const e=await ye(t);e.data.code==="200"?(o.value.status==="已出库"&&Ve(t.outboundId,o.value.userId).then(n=>{n.data.code}),w.success(e.data.data),f.value=!1,P()):w.error(e.data.data)}};return O(()=>o.value.items,()=>{F.value=o.value.items.reduce((t,e)=>t+e.quantity,0)},{deep:!0}),O(()=>o.value.saleId,t=>{if(t===0)c.value=[],o.value.items=[];else{const e=x.value.find(n=>n.saleId===t);e&&e.items&&(c.value=o.value.items.map(n=>n.productId))}}),O(c,t=>{o.value.items=t.map(e=>{var m;const n=g.value.find(_=>_.productId===e),d=(m=o.value.items)==null?void 0:m.find(_=>_.productId===e);return{productId:e,productName:(n==null?void 0:n.productName)||"",quantity:(d==null?void 0:d.quantity)||1,unitPrice:(d==null?void 0:d.unitPrice)||1}})}),ee(()=>{P(),H(),G()}),(t,e)=>{const n=ne,d=se,m=de,_=ue,A=le,I=me,S=pe,v=ie,M=ce,U=ve,$=fe,R=re,X=oe,Y=te;return r(),V("div",Ee,[e[12]||(e[12]=E("div",{class:"header"},[E("h2",null,"出库单管理")],-1)),ae((r(),k(_,{data:b.value,style:{width:"100%",height:"90%"},"row-style":{height:"70px"}},{default:u(()=>[l(n,{prop:"outboundId",label:"出库单ID"}),l(n,{prop:"saleId",label:"销售单ID"}),l(n,{prop:"userName",label:"操作人"}),l(n,{prop:"outboundDate",label:"出库日期"}),l(n,{prop:"status",label:"状态"},{default:u(a=>[l(d,{type:a.row.status==="已出库"?"success":"warning"},{default:u(()=>[i(Q(a.row.status),1)]),_:2},1032,["type"])]),_:1}),l(n,{label:"操作",width:"300",align:"center"},{default:u(a=>[l(m,{size:"small",type:"info",onClick:y=>K(a.row)},{default:u(()=>e[7]||(e[7]=[i("编辑")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,N.value]]),l(A,{"current-page":C.value,"page-size":B.value,total:T.value,background:"",style:{"margin-top":"5px","text-align":"right"},layout:"prev, pager, next",onCurrentChange:J},null,8,["current-page","page-size","total"]),l(X,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=a=>f.value=a),title:"出库单",width:"700px"},{footer:u(()=>[E("div",we,[l(m,{onClick:e[5]||(e[5]=a=>f.value=!1)},{default:u(()=>e[10]||(e[10]=[i("取消")])),_:1}),l(m,{type:"primary",onClick:W},{default:u(()=>e[11]||(e[11]=[i("提交")])),_:1})])]),default:u(()=>[l(R,{model:o.value,"label-width":"100px",disabled:o.value.status==="已出库"||o.value.status==="已取消"},{default:u(()=>[l(v,{label:"销售单ID"},{default:u(()=>[l(S,{modelValue:o.value.saleId,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.saleId=a),placeholder:"请选择销售单",disabled:""},{default:u(()=>[(r(!0),V(q,null,L(x.value,a=>(r(),k(I,{key:a.saleId,label:a.saleId,value:a.saleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"操作人"},{default:u(()=>[l(M,{modelValue:o.value.userName,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.userName=a),placeholder:"请输入操作人姓名",disabled:""},null,8,["modelValue"])]),_:1}),l(v,{label:"描述"},{default:u(()=>[l(M,{modelValue:o.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.description=a),type:"textarea",placeholder:"描述信息"},null,8,["modelValue"])]),_:1}),l(v,{label:"产品选择"},{default:u(()=>[l(S,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),multiple:"",placeholder:"请选择产品",style:{width:"100%"},disabled:""},{default:u(()=>[(r(!0),V(q,null,L(g.value,a=>(r(),k(I,{key:a.productId,label:a.productName,value:a.productId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(r(!0),V(q,null,L(o.value.items,a=>(r(),k(v,{key:a.productId,label:a.productName},{default:u(()=>[E("div",ke,[l(U,null,{default:u(()=>e[8]||(e[8]=[i("数量")])),_:1}),l($,{modelValue:a.quantity,"onUpdate:modelValue":y=>a.quantity=y,min:1,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),l(U,null,{default:u(()=>e[9]||(e[9]=[i("单价")])),_:1}),l($,{modelValue:a.unitPrice,"onUpdate:modelValue":y=>a.unitPrice=y,min:.01,step:.01,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),l(U,{type:"info"},{default:u(()=>[i("售价：¥"+Q(j(a.productId)),1)]),_:2},1024)])]),_:2},1032,["label"]))),128)),l(v,{label:"状态"},{default:u(()=>[l(S,{modelValue:o.value.status,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.status=a),placeholder:"请选择状态",style:{width:"100%"}},{default:u(()=>[l(I,{label:"待出库",value:"待出库"}),l(I,{label:"已出库",value:"已出库"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue"])])}}}),Be=_e(xe,[["__scopeId","data-v-09670d8b"]]);export{Be as default};
