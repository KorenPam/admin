import{d as H,a as d,q as J,c as K,b as V,H as $,e as l,w as t,k as O,I as Q,G as W,J as X,K as Y,n as r,C as ee,o as I,l as p,D as le,F as ae,L as oe,g as te,i as se,j as re,R as ne,M as ue,Q as de,_ as ie}from"./index-CWo0abK5.js";/* empty css                  *//* empty css               *//* empty css                 *//* empty css                */import"./el-form-item-l0sNRNKZ.js";import{i as C}from"./http-CaWKIfWx.js";import{r as pe}from"./auth-Z5GdIdVR.js";function me(m){return C.post("/user/getUserListByPage",m)}function ve(m){return C.post("/user/change-password",m)}function fe(m){return C.put("/user/update",m)}function we(m){return C.delete(`/user/delete/${m}`)}const ge={class:"users-container"},ce={class:"header"},_e={class:"dialog-footer"},be={class:"dialog-footer"},Ve=H({__name:"Users",setup(m){const P=d([]),v=d(!1),h=d(!1),_=d(!1),y=d(1),z=d(7),k=d(0),a=d({userId:"",username:"",email:"",phone:"",role:"",createTime:"",password:"",avatar:""}),S=d({userId:"",username:"",email:"",phone:"",role:""}),f=async()=>{const s=await me({page:"1",size:"10"});s.data.code==="200"?(P.value=s.data.data.records,k.value=s.data.data.total):r.error("获取用户列表失败")},D=async s=>{(await we(s.userId)).data.code==="200"?(r.success("删除用户成功"),f()):r.error("删除用户失败")},T=s=>{_.value=!0,a.value={...s},v.value=!0},B=()=>{if(!a.value.username){r.error("用户名不能为空");return}const s=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;if(!a.value.email){r.error("邮箱不能为空");return}if(!s.test(a.value.email)){r.error("邮箱格式不正确");return}const e=/^1[3-9]\d{9}$/;if(a.value.phone&&!e.test(a.value.phone)){r.error("手机号格式不正确");return}if(_.value)S.value={userId:a.value.userId,username:a.value.username,email:a.value.email,phone:a.value.phone,role:a.value.role},fe(a.value).then(n=>{n.data.code==="200"?(r.success("更新用户成功"),v.value=!1,f()):r.error("更新用户失败")});else{const n=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,32}$/;if(!a.value.password){r.error("密码不能为空");return}if(!n.test(a.value.password)){r.error("【密码】规则不正确");return}pe(a.value).then(i=>{i.data.code==="200"?(r.success("添加用户成功"),v.value=!1,f()):r.error("添加用户失败")})}},A=()=>{_.value=!1,a.value={userId:"",username:"",email:"",phone:"",role:"",createTime:"",password:"",avatar:""},v.value=!0},c=d(!1),u=d({userId:"",newPassword:"",confirmPassword:""}),F=s=>{c.value=!0,u.value={userId:s.userId,newPassword:"",confirmPassword:""}},R=()=>{const s=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,32}$/;if(!u.value.newPassword){r.error("新密码不能为空");return}if(s.test(u.value.newPassword)||r.error("【新密码】规则不正确"),u.value.newPassword!==u.value.confirmPassword){r.error("新密码和确认密码不一致");return}ve(u.value).then(e=>{e.data.code==="200"?(r.success("重置密码成功"),c.value=!1,f()):r.error("重置密码失败")})},M=s=>{y.value=s,f()},Z=s=>{z.value=s,y.value=1,f()};return J(()=>{f()}),(s,e)=>{const n=O,i=le,L=ae,N=ee,g=re,w=se,b=de,j=ue,x=te,E=X,q=Y,G=Q;return I(),K("div",ge,[V("div",ce,[e[12]||(e[12]=V("h2",null,"用户管理",-1)),l(n,{type:"primary",onClick:A},{default:t(()=>e[11]||(e[11]=[p("添加用户")])),_:1})]),$((I(),W(N,{data:P.value,style:{width:"100%",height:"90%"}},{default:t(()=>[l(i,{prop:"username",label:"用户名"}),l(i,{prop:"password",label:"密码"}),l(i,{prop:"email",label:"邮箱"}),l(i,{prop:"phone",label:"电话"}),l(i,{prop:"role",label:"角色"},{default:t(o=>[l(L,{type:o.row.role==="管理员"?"danger":"info"},{default:t(()=>[p(oe(o.row.role),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"createTime",label:"创建时间"}),l(i,{label:"操作",width:"300",align:"center"},{default:t(o=>[l(n,{size:"small",type:"primary",onClick:U=>F(o.row)},{default:t(()=>e[13]||(e[13]=[p("重置密码")])),_:2},1032,["onClick"]),l(n,{size:"small",onClick:U=>T(o.row)},{default:t(()=>e[14]||(e[14]=[p("编辑")])),_:2},1032,["onClick"]),l(n,{size:"small",type:"danger",onClick:U=>D(o.row)},{default:t(()=>e[15]||(e[15]=[p("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,h.value]]),l(E,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=o=>v.value=o),title:"添加/编辑用户",width:"500px"},{footer:t(()=>[V("span",_e,[l(n,{onClick:e[5]||(e[5]=o=>v.value=!1)},{default:t(()=>e[16]||(e[16]=[p("取消")])),_:1}),l(n,{type:"primary",onClick:B},{default:t(()=>e[17]||(e[17]=[p("确定")])),_:1})])]),default:t(()=>[l(x,{model:a.value,"label-width":"100px"},{default:t(()=>[l(w,{label:"用户名"},{default:t(()=>[l(g,{modelValue:a.value.username,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.username=o)},null,8,["modelValue"])]),_:1}),$(l(w,{label:"密码"},{default:t(()=>[l(g,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.password=o),type:"password"},null,8,["modelValue"])]),_:1},512),[[ne,!_.value]]),l(w,{label:"邮箱"},{default:t(()=>[l(g,{modelValue:a.value.email,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.email=o)},null,8,["modelValue"])]),_:1}),l(w,{label:"电话"},{default:t(()=>[l(g,{modelValue:a.value.phone,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.phone=o)},null,8,["modelValue"])]),_:1}),l(w,{label:"角色"},{default:t(()=>[l(j,{modelValue:a.value.role,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.role=o),placeholder:"请选择角色"},{default:t(()=>[l(b,{label:"管理员",value:"管理员"}),l(b,{label:"销售员",value:"销售员"}),l(b,{label:"采购员",value:"采购员"}),l(b,{label:"盘点员",value:"盘点员"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(E,{modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=o=>c.value=o),title:"重置密码",width:"300px"},{footer:t(()=>[V("span",be,[l(n,{onClick:e[9]||(e[9]=o=>c.value=!1)},{default:t(()=>e[18]||(e[18]=[p("取消")])),_:1}),l(n,{type:"primary",onClick:R},{default:t(()=>e[19]||(e[19]=[p(" 确定 ")])),_:1})])]),default:t(()=>[l(x,{model:u.value,"label-width":"100px"},{default:t(()=>[l(w,{label:"新密码"},{default:t(()=>[l(g,{modelValue:u.value.newPassword,"onUpdate:modelValue":e[7]||(e[7]=o=>u.value.newPassword=o),type:"password"},null,8,["modelValue"])]),_:1}),l(w,{label:"确认密码"},{default:t(()=>[l(g,{modelValue:u.value.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=o=>u.value.confirmPassword=o),type:"password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(q,{"current-page":y.value,"page-size":10,total:k.value,background:"",style:{"margin-top":"5px","text-align":"right"},layout:"prev, pager, next",onCurrentChange:M,onSizeChange:Z},null,8,["current-page","total"])])}}}),Ie=ie(Ve,[["__scopeId","data-v-7979e483"]]);export{Ie as default};
