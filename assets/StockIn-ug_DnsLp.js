import{d as ee,a as d,x as w,q as ae,c as y,b as V,H as O,e as l,I as te,G as h,w as n,K as le,J as ue,n as N,C as oe,o as r,D as ne,F as de,l as p,L as Q,k as se,g as re,i as ie,M as pe,N as U,O as S,j as ce,Q as me,R as ve,W as fe,P as _e,_ as be}from"./index-CWo0abK5.js";/* empty css                  *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                */import"./el-form-item-l0sNRNKZ.js";/* empty css               */import{i as L}from"./http-CaWKIfWx.js";import{l as Ie}from"./product-B2KrNTYH.js";import{a as ge}from"./purchase-BUPliIr5.js";function ye(c){return L.post("/inbound/page",c)}function Ve(c){return L.post("/inbound/update",c)}function he(c,b){return L.post(`/inbound/confirm/${c}/${b}`)}const Ne={class:"stockin-container"},Ee={style:{display:"flex","align-items":"center",gap:"10px"}},Pe={class:"dialog-footer"},ke=ee({__name:"StockIn",setup(c){const b=d([]),I=d([]),E=d([]),P=d(!1),f=d(!1),z=d(!1),k=d(null),x=d(1),B=d(10),T=d(0),u=d({inboundId:0,purchaseId:0,inboundDate:"",userId:0,userName:"",status:"待入库",description:"",items:[]}),m=d([]),F=d(0),j=a=>{const e=I.value.find(o=>o.productId===a);return(e==null?void 0:e.price)??"-"},D=async()=>{P.value=!0;try{const a=await ye({page:x.value,size:B.value});a.data.code==="200"?(b.value=a.data.data.records,T.value=a.data.data.total,P.value=!1):N.error("获取入库单失败")}finally{}},G=async()=>{const a=await ge();a.data.code==="200"&&(E.value=a.data.data)},H=async()=>{const a=await Ie();a.data.code==="200"?I.value=a.data.data:N.error("获取产品列表失败")},J=a=>{x.value=a,D()},K=a=>{f.value=!0,z.value=!0,k.value=a.inboundId,m.value=a.items.map(e=>e.productId),u.value={inboundId:a.inboundId,purchaseId:a.purchaseId,inboundDate:a.inboundDate,userId:a.userId,userName:a.userName,status:a.status,description:a.description,items:a.items.map(e=>({productId:e.productId,productName:e.productName,quantity:e.quantity,unitPrice:e.unitPrice}))}},R=async()=>{const a={...u.value,totalQuantity:F.value};if(z.value&&k.value!==null){a.inboundId=k.value;const e=await Ve(a);e.data.code==="200"?(a.status==="已入库"&&he(a.inboundId,a.userId).then(o=>{o.data.code}),N.success(e.data.data),f.value=!1,D()):N.error(e.data.data)}};return w(()=>u.value.items,()=>{F.value=u.value.items.reduce((a,e)=>a+e.quantity,0)},{deep:!0}),w(()=>u.value.purchaseId,a=>{if(a===0)m.value=[],u.value.items=[];else{const e=E.value.find(o=>o.purchaseId===a);e&&e.items&&(u.value.items=e.items.map(o=>({productId:o.productId,productName:o.productName,quantity:o.quantity||1,unitPrice:o.unitPrice||1})),m.value=u.value.items.map(o=>o.productId))}}),w(m,a=>{u.value.items=a.map(e=>{const o=I.value.find(i=>i.productId===e),s=u.value.items.find(i=>i.productId===e);return{productId:e,productName:(o==null?void 0:o.productName)||"",quantity:(s==null?void 0:s.quantity)||1,unitPrice:(s==null?void 0:s.unitPrice)||1}})}),ae(()=>{D(),H(),G()}),(a,e)=>{const o=ne,s=de,i=se,W=oe,A=le,_=me,C=pe,v=ie,M=ce,q=fe,$=_e,X=re,Y=ue,Z=te;return r(),y("div",Ne,[e[12]||(e[12]=V("div",{class:"header"},[V("h2",null,"入库单管理")],-1)),O((r(),h(W,{data:b.value,style:{width:"100%",height:"90%"},"row-style":{height:"70px"}},{default:n(()=>[l(o,{prop:"inboundId",label:"入库单ID"}),l(o,{prop:"purchaseId",label:"采购单ID"}),l(o,{prop:"userName",label:"操作人"}),l(o,{prop:"inboundDate",label:"入库日期"}),l(o,{prop:"status",label:"状态"},{default:n(t=>[l(s,{type:t.row.status==="已入库"?"success":"warning"},{default:n(()=>[p(Q(t.row.status),1)]),_:2},1032,["type"])]),_:1}),l(o,{label:"操作",width:"300",align:"center"},{default:n(t=>[l(i,{size:"small",type:"info",onClick:g=>K(t.row)},{default:n(()=>e[7]||(e[7]=[p("编辑")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,P.value]]),l(A,{"current-page":x.value,"page-size":B.value,total:T.value,background:"",style:{"margin-top":"6px","text-align":"right"},layout:"prev, pager, next",onCurrentChange:J},null,8,["current-page","page-size","total"]),l(Y,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t),title:"入库单",width:"700px"},{footer:n(()=>[V("div",Pe,[l(i,{onClick:e[5]||(e[5]=t=>f.value=!1)},{default:n(()=>e[10]||(e[10]=[p("取消")])),_:1}),l(i,{type:"primary",onClick:R},{default:n(()=>e[11]||(e[11]=[p("提交")])),_:1})])]),default:n(()=>[l(X,{model:u.value,"label-width":"100px",disabled:u.value.status==="已取消"||u.value.status==="已入库"},{default:n(()=>[l(v,{label:"采购单ID"},{default:n(()=>[l(C,{modelValue:u.value.purchaseId,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.purchaseId=t),placeholder:"请选择采购单",disabled:""},{default:n(()=>[(r(!0),y(U,null,S(E.value,t=>(r(),h(_,{key:t.purchaseId,label:t.purchaseId,value:t.purchaseId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"操作人"},{default:n(()=>[l(M,{modelValue:u.value.userName,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.userName=t),placeholder:"请输入操作人姓名",disabled:""},null,8,["modelValue"])]),_:1}),l(v,{label:"描述"},{default:n(()=>[l(M,{modelValue:u.value.description,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.description=t),type:"textarea",placeholder:"描述信息"},null,8,["modelValue"])]),_:1}),l(v,{label:"产品选择"},{default:n(()=>[l(C,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=t=>m.value=t),multiple:"",placeholder:"请选择产品",style:{width:"100%"},disabled:""},{default:n(()=>[(r(!0),y(U,null,S(I.value,t=>(r(),h(_,{key:t.productId,label:t.productName,value:t.productId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(r(!0),y(U,null,S(u.value.items,t=>(r(),h(v,{key:t.productId,label:t.productName},{default:n(()=>[V("div",Ee,[l(q,null,{default:n(()=>e[8]||(e[8]=[p("数量")])),_:1}),l($,{modelValue:t.quantity,"onUpdate:modelValue":g=>t.quantity=g,min:1,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),l(q,null,{default:n(()=>e[9]||(e[9]=[p("单价")])),_:1}),l($,{modelValue:t.unitPrice,"onUpdate:modelValue":g=>t.unitPrice=g,min:.01,step:.01,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),l(q,{type:"info"},{default:n(()=>[p("售价：¥"+Q(j(t.productId)),1)]),_:2},1024)])]),_:2},1032,["label"]))),128)),l(v,{label:"状态"},{default:n(()=>[l(C,{modelValue:u.value.status,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.status=t),placeholder:"请选择状态",style:{width:"100%"}},{default:n(()=>[l(_,{label:"待入库",value:"待入库"}),l(_,{label:"已入库",value:"已入库"}),O(l(_,{label:"已取消",value:"已取消"},null,512),[[ve,u.value.status==="已取消"]])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue"])])}}}),Fe=be(ke,[["__scopeId","data-v-2c83166a"]]);export{Fe as default};
